<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Create Actor</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>

<header>
    <!-- Поисковая строка -->
    <form action="/search" method="get" class="search-form">
        <input type="text" name="query" placeholder="Search..." required>
        <select name="type">
            <option value="movie">Movie</option>
            <option value="actor">Actor</option>
            <option value="director">Director</option>
        </select>
        <button type="submit">Search</button>
    </form>
</header>

<h1>Create Actor</h1>

<form id="createActorForm" class="create-movie-form">
    <!-- CSRF токен -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required oninput="setPhotoUrl()">
    </div>

    <div class="form-group">
        <label for="bio">Biography:</label>
        <textarea id="bio" name="bio" rows="4" required></textarea>
    </div>

    <div class="form-group">
        <label for="birthDate">Birth Date (dd/mm/yyyy):</label>
        <input type="text" id="birthDate" name="birthDate" placeholder="dd/mm/yyyy" required>
    </div>

    <div class="form-group">
        <label for="deathDate">Death Date (dd/mm/yyyy) (leave empty if alive):</label>
        <input type="text" id="deathDate" name="deathDate" placeholder="dd/mm/yyyy">
    </div>

    <div class="form-group">
        <label for="photoUrl">Photo URL:</label>
        <input type="text" id="photoUrl" name="photoUrl" readonly>
    </div>

    <button type="submit" class="submit-button">Create Actor</button>
</form>

<script>
    // Function to automatically generate and update the photo URL based on the actor's name
    function setPhotoUrl() {
        const name = document.getElementById('name').value;
        const formattedName = name.toLowerCase().replace(/\s+/g, '-');  // Format the name (lowercase and hyphenated)
        document.getElementById('photoUrl').value = `/images/actors/${formattedName}.jpg`;
    }

    document.getElementById('createActorForm').addEventListener('submit', function (event) {
        event.preventDefault();

        // Helper function to convert date from dd/mm/yyyy to yyyy-mm-dd
        function convertDateFormat(dateString) {
            if (!dateString) return '-1'; // Return -1 for empty death date
            const parts = dateString.split('/');
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`; // Convert to yyyy-mm-dd
            }
            return dateString; // If format is wrong, return original
        }

        const formData = {
            name: document.getElementById('name').value,
            bio: document.getElementById('bio').value,
            birthDate: convertDateFormat(document.getElementById('birthDate').value), // Convert birth date format
            deathDate: convertDateFormat(document.getElementById('deathDate').value), // Convert death date or send -1
            photoUrl: document.getElementById('photoUrl').value // Already set by the function
        };

        fetch('/admin/api/actors', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('input[name="_csrf"]').value
            },
            body: JSON.stringify(formData)
        })
            .then(response => {
                if (response.ok) {
                    alert('Actor created successfully!');
                } else {
                    alert('Error creating actor.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>

<footer>
    <p>&copy; 2024 Movie Catalog</p>
</footer>

</body>
</html>
